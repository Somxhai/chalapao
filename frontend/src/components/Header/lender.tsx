"use client";

import { Navbar, NavbarBrand } from "flowbite-react";

import {
	Dropdown,
	DropdownDivider,
	DropdownHeader,
	DropdownItem,
	NavbarToggle,
} from "flowbite-react";

import { ReactNode, useEffect, useState } from "react";
import Link from "next/link";

import { signOut } from "@/lib/auth-client";

import { useSession } from "@/lib/auth-client";

interface HeaderProps {
	children: ReactNode;
}

const Header = ({ children }: HeaderProps) => {
	const session = useSession();
	interface User {
		first_name: string;
		last_name: string;
	}

	const [user, setUser] = useState<User | null>(null);

	useEffect(() => {
		if (session?.data?.user) {
			const fetchUser = async () => {
				try {
					const response = await fetch(
						`/api/user/info/${session?.data?.user.id}`
					);
					if (!response.ok) {
						throw new Error("Failed to fetch user info");
					}
					const data = await response.json();
					setUser(data);
				} catch (error) {
					console.error("Error fetching user info:", error);
				}
			};

			fetchUser();
		}
	}, [session]);

	const signOutBtn = () => {
		signOut();
		window.location.href = "/auth/sign-in";
	};

	return (
		<Navbar>
			<div className="px-2 py-2.5 sm:px-4 rounded-lg border w-full flex justify-between items-center">
				<NavbarBrand href="/">
					<svg
						width="33"
						height="38"
						viewBox="0 0 33 38"
						fill="none"
						className="mx-3 h-10 sm:h-12 dark:text-white"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path
							d="M9.63023 29.7439C7.99409 29.7336 6.51756 29.3919 5.14436 28.6427C2.63447 27.2748 1.14072 25.1069 0.444931 22.3873C-0.658452 18.0758 0.292225 14.2226 3.2763 10.9327C5.3028 8.69792 7.40164 6.53121 9.48326 4.34834C10.1813 3.61533 10.6831 2.79228 10.9736 1.81571C11.5201 -0.0231668 13.5363 -0.578407 14.9784 0.689065C15.7247 1.34589 16.4538 1.33896 17.192 0.669441C18.5583 -0.570327 20.6331 -0.0185491 21.1566 1.75106C21.4586 2.7715 21.9787 3.62918 22.7101 4.39336C24.7561 6.53121 26.7872 8.68291 28.8091 10.8438C31.063 13.2518 32.1985 16.1261 32.1308 19.4276C32.071 22.3434 31.1697 24.9823 29.1203 27.1155C27.4623 28.8412 25.3887 29.6816 23.004 29.7382C22.8754 29.7416 22.7468 29.7382 22.5275 29.7382C22.6538 29.9113 22.7376 30.0314 22.826 30.148C24.2268 32.0076 24.957 34.1051 25.0121 36.4368C25.0282 37.1052 24.7848 37.3442 24.1131 37.3442C18.7558 37.3442 13.3996 37.3442 8.04232 37.3442C7.3672 37.3442 7.12608 37.1087 7.14101 36.4403C7.19153 34.1559 7.8942 32.093 9.24789 30.2553C9.35696 30.1076 9.46834 29.961 9.63023 29.7451V29.7439ZM14.4904 2.1066C14.3251 1.95769 14.1804 1.82148 14.03 1.69219C13.3813 1.13233 12.527 1.35628 12.2997 2.18279C11.9495 3.45488 11.256 4.49725 10.3559 5.43804C8.27999 7.60706 6.17081 9.74837 4.1799 11.9947C1.40824 15.1219 0.6826 18.7557 1.9915 22.7336C3.13622 26.2093 5.96414 28.3299 9.38681 28.3472C13.9278 28.3703 18.4699 28.3945 23.0098 28.3391C25.7699 28.3056 27.9044 27.0174 29.2982 24.621C31.7576 20.3937 31.1031 15.2615 27.7034 11.668C25.6792 9.52905 23.6378 7.40505 21.6434 5.23834C21.1061 4.6554 20.6824 3.95702 20.2645 3.27595C20.059 2.94119 19.9843 2.52563 19.8523 2.14585C19.6181 1.4694 18.9602 1.19467 18.3896 1.55252C18.9602 3.97202 19.8248 6.28764 21.1405 8.39663C22.051 9.85572 23.1154 11.219 24.1143 12.6227C24.399 13.0232 24.391 13.3984 24.0798 13.6628C23.7652 13.9306 23.3599 13.8786 23.0614 13.5173C20.5194 10.4421 18.4998 7.0749 17.3941 3.20208C17.3631 3.09357 17.3172 2.98968 17.2448 2.79228C17.1507 3.10742 17.0806 3.31174 17.0278 3.51952C16.2184 6.68935 16.5525 9.73913 17.9842 12.6735C18.2311 13.1791 18.1507 13.5496 17.7661 13.7516C17.37 13.9606 17.0049 13.7909 16.7488 13.268C15.3492 10.4156 14.8923 7.42467 15.4583 4.28716C15.5433 3.8185 15.6489 3.35329 15.7442 2.88694C15.2459 3.39139 14.8337 3.93855 14.4054 4.47301C12.3629 7.01488 11.0815 9.89497 10.5798 13.1248C10.5028 13.62 10.1768 13.8936 9.77375 13.8221C9.36385 13.7493 9.14685 13.3869 9.22377 12.8997C9.72897 9.68257 10.9403 6.76554 12.9036 4.17057C13.4226 3.48489 13.9508 2.80729 14.4881 2.10776L14.4904 2.1066ZM15.3802 34.5957C14.8153 34.5322 14.0472 34.755 14.0392 33.8938C14.0323 33.0027 14.8371 33.2566 15.3492 33.17V31.2284C15.2976 31.2688 15.2838 31.2758 15.2757 31.2873C15.084 31.5378 14.8945 31.7894 14.7028 32.0411C14.3274 32.534 14.1517 32.5894 13.565 32.3932C12.5489 32.0526 11.5362 31.704 10.5155 31.3785C10.3938 31.3392 10.1584 31.3797 10.0987 31.4685C9.18474 32.8087 8.66807 34.2921 8.55095 35.9301H10.5602C10.5648 35.7046 10.4255 35.4349 10.1423 35.1209C9.82426 34.7688 9.80819 34.3717 10.0998 34.0866C10.3811 33.8119 10.7612 33.828 11.0987 34.1235C11.628 34.5864 12.1057 35.0736 11.9644 35.8724C11.961 35.8908 11.9943 35.9162 12.0023 35.9266H15.3802V34.5957ZM23.6034 35.9393C23.4897 34.3336 22.9833 32.893 22.1394 31.5574C21.981 31.3069 21.8363 31.2919 21.5849 31.3797C20.6262 31.7144 19.6594 32.0284 18.6961 32.3505C17.9441 32.6021 17.8522 32.5721 17.3642 31.9245C17.1909 31.6936 17.0129 31.4651 16.7856 31.1696V33.1804C17.3321 33.2405 18.1037 33.0165 18.114 33.8742C18.1243 34.7653 17.3195 34.5183 16.7971 34.6037V35.9382H20.2507C19.9648 35.0909 20.5125 34.6361 21.02 34.1605C21.3736 33.8303 21.7571 33.8003 22.0499 34.082C22.3553 34.3752 22.3312 34.778 21.9844 35.1486C21.9156 35.2225 21.8249 35.2802 21.7766 35.3656C21.6802 35.533 21.6078 35.7131 21.4988 35.9416H23.6034V35.9393ZM11.1963 29.9852C11.2124 30.0395 11.2285 30.0949 11.2445 30.1491C12.0012 30.4054 12.7567 30.6674 13.5168 30.911C13.6155 30.9433 13.7946 30.9248 13.8509 30.8567C14.1322 30.5208 14.3848 30.1607 14.7017 29.737C13.7177 29.737 12.8233 29.7197 11.93 29.7486C11.6831 29.7566 11.4409 29.9021 11.1963 29.9852ZM20.9373 30.1433C20.7869 29.8317 20.5699 29.7151 20.2427 29.7301C19.7295 29.7532 19.2139 29.7359 18.6996 29.7359C18.3103 29.7359 17.9211 29.7359 17.4595 29.7359C17.765 30.1491 17.998 30.492 18.2633 30.8083C18.3321 30.8902 18.5181 30.9445 18.6192 30.9133C19.393 30.6709 20.16 30.4042 20.9373 30.1433Z"
							fill="currentColor"
						/>
						<path
							d="M20.2072 16.596C19.6434 16.5983 19.1704 16.1227 19.1738 15.5548C19.1773 15.0041 19.6285 14.5413 20.1762 14.5274C20.7411 14.5135 21.221 14.9776 21.2302 15.5455C21.2394 16.1135 20.7709 16.5925 20.2072 16.5948V16.596Z"
							fill="currentColor"
						/>
						<path
							d="M12.9796 15.5663C12.9761 16.1343 12.4996 16.6041 11.9359 16.596C11.3721 16.5868 10.9083 16.1008 10.9232 15.5352C10.937 14.9857 11.3985 14.5309 11.9462 14.5286C12.5111 14.5251 12.983 14.9996 12.9796 15.5675V15.5663Z"
							fill="currentColor"
						/>
						<path
							d="M5.18834 20.7505C4.60623 20.732 4.25374 20.2865 4.42367 19.8732C4.6533 19.3168 4.92542 18.7754 5.23312 18.2583C5.41338 17.9558 5.74405 17.8912 6.06784 18.0655C6.4008 18.2444 6.54892 18.5457 6.39621 18.8989C6.17002 19.4253 5.91513 19.9448 5.62465 20.4377C5.52361 20.6074 5.27675 20.6905 5.18834 20.7505Z"
							fill="currentColor"
						/>
						<path
							d="M24.4438 20.7505C23.8628 20.7331 23.5092 20.2864 23.678 19.8743C23.9065 19.3179 24.1797 18.7765 24.4874 18.2594C24.6677 17.9569 24.9984 17.8923 25.321 18.0666C25.654 18.2455 25.8021 18.5468 25.6505 18.9C25.4243 19.4264 25.1706 19.9459 24.879 20.4388C24.7779 20.6096 24.5311 20.6916 24.4427 20.7516L24.4438 20.7505Z"
							fill="currentColor"
						/>
						<path
							d="M7.26331 20.7505C6.65364 20.7332 6.31723 20.2703 6.49979 19.8339C6.71564 19.3179 6.97168 18.8181 7.2415 18.3275C7.4298 17.9858 7.80525 17.8946 8.13133 18.062C8.4597 18.2317 8.60552 18.5826 8.44707 18.9382C8.22547 19.4357 7.9924 19.9332 7.71339 20.3996C7.60432 20.5831 7.35517 20.6812 7.26446 20.7493L7.26331 20.7505Z"
							fill="currentColor"
						/>
						<path
							d="M27.7705 18.7431C27.743 18.8216 27.7108 18.9474 27.6546 19.0617C27.4341 19.513 27.2206 19.9701 26.9749 20.4076C26.7831 20.747 26.4077 20.8371 26.0827 20.6697C25.7544 20.5 25.6108 20.1468 25.7704 19.7924C25.9932 19.2949 26.2354 18.8043 26.4984 18.3264C26.6603 18.032 26.9416 17.9166 27.2699 18.0158C27.5926 18.114 27.7533 18.3541 27.7717 18.7442L27.7705 18.7431Z"
							fill="currentColor"
						/>
						<path
							d="M22.821 17.9812C23.4261 17.9939 23.7705 18.4591 23.5903 18.8931C23.3698 19.4218 23.1126 19.9401 22.8244 20.4353C22.6373 20.7574 22.3135 20.8394 21.9633 20.672C21.6281 20.5127 21.4822 20.1548 21.6395 19.7993C21.8611 19.3018 22.0942 18.8043 22.3732 18.3379C22.4834 18.1544 22.7291 18.0516 22.821 17.9824V17.9812Z"
							fill="currentColor"
						/>
						<path
							d="M9.72771 17.9881C10.3489 17.9719 10.7094 18.451 10.5211 18.9046C10.3052 19.4206 10.0503 19.9216 9.77938 20.411C9.59223 20.7493 9.20874 20.837 8.88611 20.6673C8.56118 20.4965 8.41996 20.1432 8.57955 19.7865C8.79655 19.3017 9.02389 18.818 9.29371 18.3632C9.40508 18.1762 9.63816 18.0619 9.72886 17.9881H9.72771Z"
							fill="currentColor"
						/>
						<path
							d="M16.0797 20.8151C15.5275 20.6592 14.9844 20.5427 14.4688 20.351C14.0544 20.1964 13.9154 19.8004 14.0704 19.4426C14.2277 19.0778 14.5928 18.922 14.997 19.0974C15.7203 19.4126 16.4276 19.4137 17.1521 19.0997C17.5597 18.9231 17.9202 19.072 18.0821 19.4368C18.2406 19.7958 18.1051 20.194 17.6929 20.3487C17.1774 20.5415 16.6354 20.6593 16.082 20.8162L16.0797 20.8151Z"
							fill="currentColor"
						/>
					</svg>
					<div className="flex justify-start items-end w-full ms-2">
						<h1 className="text-3xl text-gray-800">
							<span className="font-black">Chalapao</span> Lender
							Center
						</h1>
					</div>
				</NavbarBrand>
				<div className="flex md:order-2 gap-6 md:gap-8 items-center justify-end">
					<Link
						href="/lender/items"
						className="inline-flex items-center rounded-lg p-2 text-gray-500
                                    hover:bg-gray-100 focus:outline-none focus:ring-2
                                    focus:ring-gray-200 dark:text-gray-400
                                    dark:hover:bg-gray-700 dark:focus:ring-gray-600"
					>
						<svg
							width="34"
							height="35"
							viewBox="0 0 34 35"
							className="h-8"
							fill="none"
							xmlns="http://www.w3.org/2000/svg"
						>
							<path
								d="M2.72259 17.5599C2.72259 16.0036 2.70266 14.4473 2.72674 12.8918C2.76495 10.4256 3.90617 8.64789 6.09726 7.59575C8.90463 6.24733 11.7286 4.93342 14.5476 3.60941C16.1556 2.8544 17.7778 2.83672 19.3874 3.58753C22.2289 4.91238 25.0687 6.2406 27.8951 7.59828C30.0239 8.62096 31.2058 10.3456 31.2457 12.7437C31.298 15.9497 31.298 19.1575 31.2457 22.3636C31.2067 24.733 30.0563 26.4677 27.9458 27.4736C25.1069 28.8271 22.2388 30.1182 19.3833 31.4372C18.4979 31.8463 17.5718 32.018 16.5992 31.9549C15.8965 31.9094 15.232 31.7251 14.5941 31.4313C11.766 30.1283 8.92872 28.8456 6.11387 27.5131C3.90534 26.4677 2.76329 24.6757 2.72674 22.1969C2.70432 20.6515 2.72259 19.1061 2.72259 17.5599ZM29.2697 12.7327C29.1335 12.7925 29.0588 12.8236 28.9857 12.859C25.3926 14.5836 21.8003 16.31 18.2039 18.0279C18.0195 18.1163 17.9838 18.2274 17.9838 18.4143C17.9887 22.1144 17.9879 25.8137 17.9879 29.5139C17.9879 29.6031 17.9979 29.6923 18.0054 29.822C18.2736 29.71 18.5137 29.6174 18.7471 29.5105C21.4805 28.2522 24.2123 26.9896 26.9458 25.7312C28.5056 25.0133 29.2772 23.7945 29.2722 22.053C29.2623 19.0784 29.2697 16.1038 29.2697 13.1292V12.7336V12.7327ZM4.73011 12.7285C4.72264 12.8573 4.71516 12.9196 4.71516 12.9819C4.71516 16.0718 4.70104 19.1625 4.72015 22.2525C4.73011 23.8753 5.51917 25.0217 6.96439 25.6925C9.76927 26.9946 12.5808 28.2833 15.3898 29.5753C15.5759 29.6603 15.7686 29.7294 15.982 29.8152C15.9879 29.6957 15.9962 29.6141 15.9962 29.5332C15.9962 25.823 15.9945 22.1127 16.0028 18.4025C16.0028 18.1836 15.9239 18.0944 15.7428 18.0086C12.6622 16.5364 9.58405 15.0575 6.50507 13.5795C5.92782 13.3026 5.34973 13.0265 4.73011 12.7293V12.7285ZM22.3751 13.7958C22.292 13.7419 22.2538 13.7116 22.2098 13.6897C21.3269 13.2512 20.4423 12.8144 19.5594 12.3767C16.5643 10.8936 13.57 9.40964 10.5716 7.93328C10.4587 7.87773 10.2817 7.85584 10.1729 7.9055C9.00431 8.44251 7.83816 8.98794 6.68116 9.55021C6.12384 9.82124 5.67781 10.232 5.3381 10.7673C5.39292 10.8018 5.41784 10.8212 5.44608 10.8347C9.23438 12.6544 13.0218 14.4751 16.8143 16.2864C16.9223 16.3378 17.0992 16.3234 17.2121 16.2704C18.414 15.7048 19.6092 15.1257 20.8061 14.55C21.3161 14.305 21.826 14.0592 22.3751 13.795V13.7958ZM28.6568 10.7799C28.2639 10.1865 27.7805 9.76821 27.1866 9.48792C24.2979 8.12182 21.4099 6.75488 18.5153 5.40226C17.4887 4.92248 16.4463 4.94437 15.4189 5.42414C14.6108 5.80207 13.8051 6.18589 12.9994 6.56803C12.9081 6.61095 12.82 6.65977 12.6888 6.72711C13.4164 7.0882 14.0999 7.42909 14.7843 7.76746C18.002 9.35914 21.2197 10.9525 24.4407 12.5383C24.5595 12.5964 24.7364 12.6527 24.8394 12.6048C26.1077 12.0122 27.3669 11.4003 28.6576 10.7799H28.6568Z"
								fill="#545454"
							/>
							<path
								d="M12.9817 25.9307C12.8255 25.8802 12.6636 25.8448 12.5149 25.7784C11.6835 25.4046 10.8545 25.0259 10.0265 24.6437C9.44255 24.3735 9.20999 23.8205 9.44505 23.2827C9.67844 22.7482 10.2507 22.5437 10.8305 22.8038C11.7001 23.1935 12.5689 23.5865 13.4302 23.9948C13.8787 24.2077 14.0905 24.6917 13.9717 25.1445C13.8496 25.6092 13.4618 25.9088 12.9817 25.9324V25.9307Z"
								fill="#545454"
							/>
						</svg>
					</Link>
					<Link
						href="/lender/rentals"
						className="inline-flex items-center rounded-lg p-2 text-gray-500
                                    hover:bg-gray-100 focus:outline-none focus:ring-2
                                    focus:ring-gray-200 dark:text-gray-400
                                    dark:hover:bg-gray-700 dark:focus:ring-gray-600"
					>
						<svg
							width="33"
							height="34"
							viewBox="0 0 33 34"
							className="h-8"
							fill="none"
							xmlns="http://www.w3.org/2000/svg"
						>
							<path
								d="M4.91414 16.6762C4.91414 13.4947 4.91253 10.3123 4.91414 7.13083C4.91575 5.10957 6.2185 3.52739 8.17262 3.17907C8.4185 3.13573 8.67324 3.13492 8.92396 3.13492C13.9713 3.13246 19.0186 3.13165 24.066 3.13328C26.4337 3.1341 28.0847 4.81276 28.0847 7.21423C28.0847 13.5675 28.0863 19.9215 28.0847 26.2747C28.0847 27.8594 26.8698 29.0556 25.3599 28.9714C24.6682 28.9321 24.0966 28.5871 23.538 28.2232C22.24 27.3778 20.9687 27.408 19.67 28.2437C17.5434 29.6116 15.3918 29.6083 13.2635 28.2437C11.9841 27.4227 10.733 27.3949 9.45441 28.233C8.89091 28.6026 8.31531 28.964 7.60428 28.982C6.09596 29.0196 4.91817 27.8765 4.91575 26.3442C4.91091 23.1218 4.91414 19.8986 4.91414 16.6762ZM7.49384 26.354C7.58977 26.3115 7.63653 26.2952 7.67845 26.2706C7.86064 26.1627 8.04202 26.0532 8.2226 25.9436C10.3452 24.6549 12.459 24.6705 14.5654 25.9869C14.8041 26.1357 15.0427 26.296 15.3007 26.4007C16.3761 26.8332 17.4031 26.7138 18.3778 26.0818C20.5431 24.677 22.7286 24.6402 24.9326 25.9918C25.1269 26.1112 25.3252 26.224 25.5493 26.3565C25.559 26.2453 25.5711 26.1774 25.5711 26.1096C25.5711 19.776 25.5735 13.4432 25.5695 7.10957C25.5695 6.27065 25.035 5.73672 24.2014 5.73672C19.0936 5.73345 13.9858 5.73181 8.8772 5.74407C8.60956 5.74407 8.31612 5.83238 8.08153 5.96566C7.61315 6.23058 7.48981 6.69174 7.48981 7.2175C7.49545 13.4792 7.49303 19.7416 7.49303 26.0033C7.49303 26.1047 7.49303 26.2061 7.49303 26.354H7.49384Z"
								fill="currentColor"
							/>
							<path
								d="M16.4875 16.1856C14.7784 16.1856 13.0694 16.1897 11.3603 16.1832C10.7315 16.1807 10.2237 15.7588 10.0987 15.1619C9.97295 14.5625 10.2446 13.9624 10.7912 13.7138C10.9863 13.6247 11.2168 13.5748 11.4313 13.5748C14.8091 13.5666 18.1877 13.5666 21.5655 13.5707C22.3603 13.5715 22.944 14.1415 22.94 14.8847C22.9359 15.6345 22.3547 16.184 21.555 16.1848C19.8661 16.1872 18.1772 16.1848 16.4875 16.1848V16.1856Z"
								fill="currentColor"
							/>
							<path
								d="M16.5146 8.35159C18.2236 8.35159 19.9327 8.3475 21.6417 8.35404C22.306 8.35649 22.8115 8.80866 22.9179 9.46606C23.0162 10.0752 22.6591 10.6868 22.0698 10.8831C21.9013 10.9395 21.7151 10.964 21.5377 10.9648C18.1801 10.9697 14.8216 10.9681 11.464 10.9689C10.8916 10.9689 10.4418 10.7457 10.1911 10.211C9.96374 9.72608 10.0282 9.25429 10.358 8.83401C10.6256 8.49304 10.9892 8.34995 11.418 8.35077C13.1174 8.35404 14.816 8.35241 16.5154 8.35241L16.5146 8.35159Z"
								fill="currentColor"
							/>
							<path
								d="M13.9458 18.8046C14.8092 18.8046 15.6734 18.7939 16.5368 18.8078C17.1825 18.8185 17.7041 19.3058 17.771 19.9248C17.8435 20.5944 17.4727 21.175 16.852 21.354C16.7472 21.3843 16.6343 21.399 16.5255 21.399C14.7882 21.4015 13.0501 21.4088 11.3129 21.3966C10.6446 21.3917 10.1456 20.8962 10.069 20.2183C10.0013 19.6173 10.4019 19.018 10.9985 18.8528C11.1508 18.8103 11.3161 18.8046 11.4749 18.8038C12.2988 18.7989 13.1219 18.8013 13.9458 18.8013V18.8038V18.8046Z"
								fill="currentColor"
							/>
						</svg>
					</Link>
					<Dropdown
						arrowIcon={false}
						inline
						label=""
						renderTrigger={() => (
							<button
								type="button"
								className="inline-flex items-center rounded-lg p-2 text-gray-500
                                    hover:bg-gray-100 focus:outline-none focus:ring-2
                                    focus:ring-gray-200 dark:text-gray-400
                                    dark:hover:bg-gray-700 dark:focus:ring-gray-600"
							>
								<svg
									className="h-8"
									aria-hidden="true"
									xmlns="http://www.w3.org/2000/svg"
									width="32"
									height="32"
									fill="none"
									viewBox="2 2 21 21"
								>
									<path
										stroke="currentColor"
										strokeWidth="1.5"
										d="M7 17v1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1a3 3 0 0 0-3-3h-4a3 3 0 0 0-3 3Zm8-9a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
									/>
								</svg>
							</button>
						)}
					>
						<DropdownHeader>
							<span className="block text-sm">
								{user?.first_name} {user?.last_name}
							</span>
						</DropdownHeader>
						<DropdownDivider />
						<DropdownItem onClick={() => signOutBtn()}>
							Sign Out
						</DropdownItem>
					</Dropdown>

					<NavbarToggle />
				</div>
			</div>
			<div className="flex items-center justify-between w-full">
				{children}
			</div>
		</Navbar>
	);
};

export default Header;
